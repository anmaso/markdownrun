# Story 1.4: Results File System Foundation

Status: Done

## Story
**As a** user,
**I want** execution results stored in a separate file,
**so that** my original markdown remains unchanged while I can review execution history.

## Acceptance Criteria
1. Plugin creates a .result file alongside the markdown file (e.g., README.md â†’ README.md.result)
2. Results file uses JSON format for structured data storage
3. Each execution result includes: timestamp, command, exit code, stdout, stderr, duration
4. Plugin handles concurrent access to results file safely
5. Results file is human-readable when opened directly
6. Plugin creates results file directory if it doesn't exist

## Tasks / Subtasks
- [x] Implement JSON sidecar writer in `lua/markdownrun/results.lua`
  - [x] Schema v1 per architecture
  - [x] Append-merge write with atomic rename
  - [x] Cross-instance locking with lock file
- [x] Include all required fields (timestamp, command, exit, stdout/err refs, duration)
- [x] Ensure human-readable formatting
- [x] Create artifacts directory for large outputs

## Dev Notes
- Results schema and IO strategy in "7. Results Persistence". [Source: architecture.md#7.-Results-Persistence]
- Locking and atomicity are required for multi-instance safety. [Source: architecture.md#7.-Results-Persistence]

### Testing
- Unit: schema generation, atomic write, lock contention simulation. [Source: architecture.md#13.-Testing-Strategy]

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-08 | 0.1 | Initial draft | PO Agent |
| 2025-08-08 | 0.2 | Implemented results sidecar, artifacts, and locking | dev.mdc |
